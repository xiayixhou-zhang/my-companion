<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>我的陪伴</title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial; margin: 16px; }
      #chat { max-width: 720px; margin: 0 auto 12px; }
      .me { margin: 10px 0; white-space: pre-wrap; }
      .it { margin: 10px 0; opacity: 0.95; white-space: pre-wrap; }
      textarea { width: 100%; height: 70px; max-width: 720px; display: block; margin: 0 auto; }
      button { display: block; margin: 10px auto; padding: 10px 14px; }
    </style>
  </head>
  <body>
    <div id="chat"></div>
    <textarea id="input" placeholder="像微信一样说一句…（短一点更省钱）"></textarea>
    <button id="send">发送</button>

    <script>
      const chat = document.getElementById("chat");
      const input = document.getElementById("input");
      const btn = document.getElementById("send");

      function addLine(cls, text) {
        const p = document.createElement("div");
        p.className = cls;
        p.textContent = text;
        chat.appendChild(p);
        window.scrollTo(0, document.body.scrollHeight);
      }

      btn.onclick = async () => {
        const msg = input.value.trim();
        if (!msg) return;
        input.value = "";
        addLine("me", "我： " + msg);
        btn.disabled = true;
        btn.textContent = "发送中…";

        try {
          const res = await fetch("/api/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: msg })
          });
          const data = await res.json();
          addLine("it", "它： " + (data.reply || "(没收到回复)"));
        } catch (e) {
          addLine("it", "它： (出错了) " + e);
        } finally {
          btn.disabled = false;
          btn.textContent = "发送";
        }
      };
    </script>
  </body>
</html>
